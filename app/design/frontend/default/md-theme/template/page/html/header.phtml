<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     md-theme
 * @copyright   Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/**
 * @var Mage_Page_Block_Html_Header $this
 */
?>
<script>
    jQuery.noConflict()
    jQuery("body").addClass("withTopbar")

</script>
<body>
    <div id="mainWrapper">
        <div id="header" class="parralax">
            <div id="topBar" class="clearfix">
                <a href="#" class="freeShipping info"><?php echo $this->__('FREE US SHIPPING') ?> <span><?php echo $this->__('USE CODE: FREESHIPPING') ?></span></a>
                <a href="tel:18888825788" class="phone info"><?php echo $this->__('1-888-882-5788') ?></a>
                <a href="#" class="gifts info"><?php echo $this->__('GIFT CERTIFICATES') ?></a>
                <?php   $count = ($this->helper('checkout/cart')->getSummaryCount() ? $this->helper('checkout/cart')->getSummaryCount() : 0  ) ?>
                <a href="<?php echo Mage::getUrl('checkout/cart'); ?>" class="shoppingBag cart-link"><span class="badge"><?php echo $count?></span> <?php echo $this->__('Shopping Bag') ?></a>
                
                <?php if (Mage::helper('customer')->isLoggedIn() ): ?>
                        <a class="signin info" href="<?php echo Mage::helper('customer')->getLogoutUrl(); ?>"><?php echo $this->__('LOG OUT')?></a>

                <?php 
                    
                else: ?>
                       
                        <a class="signin info" href="<?php echo Mage::helper('customer')->getLoginUrl(); ?>"><?php echo $this->__('SIGN IN') ?></a>
                <?php 
                    
                endif; ?>
                <a href="<?php echo Mage::getUrl('customer/account'); ?>" class="myAccount info"><?php echo $this->__('MY ACCOUNT') ?></a>
            </div>
            <div id="topNavi" class="blueVer">

                <a href="<?php echo Mage::getUrl('home'); ?>" class="logo">MD</a>
                <a href="#" class="search"><img src="<?php echo $this->getSkinUrl('images/search-new.png') ?>"><?php echo $this->__('Search Products') ?></a>
                <?php echo $this->getLayout()->createBlock('core/template')->setTemplate('currency/currency.phtml')->toHtml(); ?>
                <!-- Custom Currency -->
                    
                    <!-- <?php //echo //$this->getChildHtml('custom_currency_selector') ?> -->
                    
                <!-- END of Custom Currency -->

                <ul class="navi">
                    <li class="shop"><a href="#"><?php echo $this->__('SHOP') ?></a>
                    <div class="sub">
                     <div class="inner"> 
                      <ul class="types">
                        
                        <?php
                            $obj = new Mage_Catalog_Block_Navigation();
                            $storeCategories = $obj->getStoreCategories();
                            Mage::registry('current_category') ? $currentCategoryId = Mage::registry('current_category')->getId() : $currentCategoryId='';
                            $limit_category = 4;
                            $ctr = 1;

                            foreach ($storeCategories as $_category):
                            if($ctr <= $limit_category) :
                        ?>
                    <li> 

                        <a href="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).$_category->getUrlKey(); ?>">
                        
                        <?php
                            $_category = Mage::getModel('catalog/category')->load($_category->getId());
                            
                            if ($_imgUrl = $_category->getImageUrl()) {
                                echo "<img src=".$_imgUrl." >";     
                            }
                        ?>
                        <span><?php echo $_category->getName(); ?></span></a>
                        <ul>
                        <?php 
                            
                            
                                $_subcategories = $_category->getChildrenCategories();
                                if (count($_subcategories) > 0){    

                                    foreach($_subcategories as $_subcategory){
                                        //load products now
                                    $products = Mage::getModel('catalog/category')->load($_subcategory->getId())
                                     ->getProductCollection()
                                     ->addAttributeToSelect('*')
                                     ->addAttributeToFilter('status', 1)
                                     ->addAttributeToFilter('visibility', 4)
                                     ->setOrder('price', 'ASC');
                                         echo '
                                         <li><a href="'.$_subcategory->getUrl().'">'.$_subcategory->getName().'</a>';
                                         if (count($products) > 0){    

                                            echo '<ul>';
                                            foreach($products as $_product){
                                               echo '<li>
                                                    <a href="'.$_product->getProductUrl().'">
                                                    <div class="image">
                                                        <img src="'.$_product->getImageUrl().'">                                                    
                                                    </div>
                                                    <div class="desc">'.$_product->getName().'</div>
                                                    </a>
                                                </li>';
                                            }
                                                
                                            echo '</ul>';
                                        }
                                         echo '</li>';
                                    }// end foreach subcat
                                }// end if count sub
                            
                        ?>      
                         </ul>
                        </li>
                        <?php  $ctr++; endif;   endforeach; ?>                           
                       </ul> 
                     </div>
                    </div>
                    </li>  
                    <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('header_lg')->toHtml(); ?>      
                </ul>    


               <!--  <ul class="navi">
                    
                    <li><a href="http://md-factor.com/about">ABOUT</a></li>
                    <li><a href="http://md-factor.com/rewards">REWARDS</a></li>
                    <li><a href="https://us.md-factor.com/categories.php">STORES</a></li>
                    <li><a href="http://md-factor.com/blog">BLOG</a></li>
                    <li><a href="http://md-factor.com/pressmedia">MEDIA</a></li>
                </ul> -->

            </div>

            <div id="mobileMenu">
                <a href="<?php echo Mage::getUrl('home'); ?>" class="logo">MD</a>
                <a href="#" class="menuBtn"><span></span><span></span><span></span></a>
            </div>
            
            <div id="mobileNavi">
                <a href="#" class="closeBtn">Close</a>
                <div class="inner">
                    <ul class="links">
                    <li class="hasSub"><a href="#" class="shop"><?php echo $this->__('SHOP') ?></a> 
                      <ul class="types">
                        <?php
                            $obj = new Mage_Catalog_Block_Navigation();
                            $storeCategories = $obj->getStoreCategories();
                            Mage::registry('current_category') ? $currentCategoryId = Mage::registry('current_category')->getId() : $currentCategoryId='';
                            $limit_category = 4;
                            $ctr = 1;

                            foreach ($storeCategories as $_category):
                            if($ctr <= $limit_category) :
                        ?>
                    <li class="hasSub"> 
                        <a href="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB).$_category->getUrlKey(); ?>">
                        <?php
                            $_category = Mage::getModel('catalog/category')->load($_category->getId());
                        
                            if ($_imgUrl = $_category->getImageUrl()) {
                                    
                            }
                        ?>
                        <?php echo $_category->getName(); ?></a>
                        <ul>
                        <?php 
                            
                            
                                $_subcategories = $_category->getChildrenCategories();
                                if (count($_subcategories) > 0){    

                                    foreach($_subcategories as $_subcategory){
                                        //load products now
                                    $products = Mage::getModel('catalog/category')->load($_subcategory->getId())
                                     ->getProductCollection()
                                     ->addAttributeToSelect('*')
                                     ->addAttributeToFilter('status', 1)
                                     ->addAttributeToFilter('visibility', 4)
                                     ->setOrder('price', 'ASC');
                                         echo '
                                         <li><a href="'.$_subcategory->getUrl().'">'.$_subcategory->getName().'</a>';
                                         if (count($products) > 0){    

                                            echo '<ul>';
                                            foreach($products as $_product){
                                               echo '<li>
                                                <a href="'.$_product->getProductUrl().'">'.$_product->getName().'</a>
                                                </li>';
                                            }
                                                
                                            echo '</ul>';
                                        }
                                         echo '</li>';
                                    }// end foreach subcat
                                }// end if count sub
                            
                        ?>      
                         </ul>
                        </li>
                        <?php  $ctr++; endif;   endforeach; ?>                           
                       </ul> 
                    <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('header_lg')->toHtml(); ?>      
                    </ul> 
                    
                    <div class="search">
                        <input type="text" class="query"/>
                        <input type="submit" value="" class="searchBtn"/>
                    </div>

                    <!-- Custom Currency -->
                    
                    <?php echo $this->getChildHtml('custom_currency_selector') ?>
                    
                    <!-- END of Custom Currency -->
                    
                </div>
            </div><!-- END mobileNavi -->
            
            
        </div><!-- END header -->


